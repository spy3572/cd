import java.util.*;

public class Main {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        System.out.println("Enter the productions (one per line, press ENTER to stop):");

        List<String> productions = new ArrayList<>();
        while (true) {
            String input = sc.nextLine().trim();
            if (input.isEmpty()) break; // Stop when an empty line is entered
            productions.add(input);
        }

        for (String production : productions) {
            String[] parts = production.split("->");
            if (parts.length < 2) {
                System.out.println("Invalid production format: " + production);
                continue;
            }

            String lhs = parts[0].trim();
            String[] rhs = parts[1].split("\\|");

            String prefix = rhs[0];
            for (String r : rhs) {
                while (!r.startsWith(prefix)) {
                    prefix = prefix.substring(0, prefix.length() - 1);
                    if (prefix.isEmpty()) break;
                }
            }

            if (!prefix.isEmpty()) {
                System.out.println(lhs + "->" + prefix + lhs + "'");
                List<String> newRhs = new ArrayList<>();
                for (String r : rhs) {
                    newRhs.add(r.startsWith(prefix) ? r.substring(prefix.length()).trim() : r);
                }
                System.out.println(lhs + "'->" + String.join("|", newRhs));
            } else {
                System.out.println("No left factoring for: " + lhs + "->" + String.join("|", rhs));
            }
        }

        sc.close();
    }
}
